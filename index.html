<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Ultimate GUI æ›´æ–°æ—¥å¿—ç”Ÿæˆå™¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f9fafb; color: #1f2937; padding: 20px; }
    .container { max-width: 800px; margin: auto; }
    h2 { color: #10b981; }
    input, button { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.9em; }
    button { background-color: #10b981; color: white; cursor: pointer; }
    #output, #mdOutput { background: #f3f4f6; padding: 15px; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 10px; white-space: pre-wrap; }
    img.preview { max-width: 200px; margin-top: 10px; border: 1px solid #ccc; border-radius: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ“¦ æ›´æ–°æ—¥å¿—ç”Ÿæˆå™¨ï¼ˆå¢å¼ºç‰ˆï¼‰</h2>
    
    <label>ä¸Šä¼  .zip æ–‡ä»¶ï¼š</label>
    <input type="file" id="zipInput" accept=".zip">

    <label>ç‰ˆæœ¬å·ï¼š</label>
    <input type="text" id="versionInput" placeholder="ä¾‹å¦‚ï¼šv0.1.2">

    <label>ä¿®è®¢ç¼–å·ï¼š</label>
    <input type="number" id="uploadCount" value="1" min="1">

    <button onclick="processZip()">ğŸ“‚ åˆ†æå¹¶ç”Ÿæˆæ—¥å¿—</button>

    <h3>ğŸ§¾ æ›´æ–°æ—¥å¿—ï¼š</h3>
    <div id="output">(å†…å®¹æ˜¾ç¤ºåœ¨æ­¤)</div>

    <h3>ğŸ“˜ Markdown æ ¼å¼ï¼š</h3>
    <div id="mdOutput">(Markdownæ˜¾ç¤ºåœ¨æ­¤)</div>

    <h3>ğŸ–¼ï¸ æ–‡ä»¶é¢„è§ˆï¼š</h3>
    <div id="imagePreview"></div>
  </div>

  <script>
    async function processZip() {
      const zipFile = document.getElementById('zipInput').files[0];
      if (!zipFile) return;

      const version = document.getElementById('versionInput').value.trim();
      const count = document.getElementById('uploadCount').value;
      const today = new Date().toISOString().split("T")[0];

      const reader = new FileReader();
      reader.onload = async function (e) {
        const zip = await JSZip.loadAsync(e.target.result);
        const fileList = Object.keys(zip.files);

        // ğŸ” ç¼“å­˜å¯¹æ¯”
        const previousFiles = JSON.parse(localStorage.getItem("prevZipFiles")) || [];
        const added = fileList.filter(f => !previousFiles.includes(f));
        const removed = previousFiles.filter(f => !fileList.includes(f));
        localStorage.setItem("prevZipFiles", JSON.stringify(fileList));

        // ğŸ“ æ—¥å¿—ç”Ÿæˆ
        const log = `ğŸ“Œ æ›´æ–°æ—¥å¿—ï¼ˆ${today})
- ğŸ“ æ–‡ä»¶åï¼š${zipFile.name}
- ğŸ›  ç‰ˆæœ¬å·ï¼š${version}
- ğŸ§¬ ä¿®è®¢ç¼–å·ï¼šç¬¬ ${count} æ¬¡ä¿®è®¢
- ğŸ“‚ æ–‡ä»¶æ•°ï¼š${fileList.length}
- â• æ–°å¢æ–‡ä»¶æ•°ï¼š${added.length}
- â– ç§»é™¤æ–‡ä»¶æ•°ï¼š${removed.length}
- ğŸ–¼ï¸ å¯è§†åŒ–çº¹ç†ï¼šä»¥ä¸‹å±•ç¤ºéƒ¨åˆ† PNG æ–‡ä»¶
`;
        document.getElementById("output").innerText = log;

        const markdown = `## ğŸ“Œ æ›´æ–°æ—¥å¿—ï¼ˆ${today})
**æ–‡ä»¶å**ï¼š\`${zipFile.name}\`  
**ç‰ˆæœ¬å·**ï¼š\`${version}\`  
**ä¿®è®¢ç¼–å·**ï¼šç¬¬ ${count} æ¬¡ä¿®è®¢  
**æ–°å¢æ–‡ä»¶**ï¼š${added.map(f => `- ${f}`).join('\n')}  
**ç§»é™¤æ–‡ä»¶**ï¼š${removed.map(f => `- ${f}`).join('\n')}
`;
        document.getElementById("mdOutput").innerText = markdown;

        // ğŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆï¼ˆPNGï¼‰
        const previewDiv = document.getElementById("imagePreview");
        previewDiv.innerHTML = "";
        for (const fileName of fileList.filter(f => f.endsWith(".png")).slice(0, 3)) {
          const content = await zip.file(fileName).async("base64");
          const img = document.createElement("img");
          img.src = `data:image/png;base64,${content}`;
          img.alt = fileName;
          img.className = "preview";
          previewDiv.appendChild(img);
        }
      };
      reader.readAsArrayBuffer(zipFile);
    }
  </script>
</body>
</html>
